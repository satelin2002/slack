// Generated by CoffeeScript 1.9.3
(function() {
  var highlightBlock, init, processTagCount;

  init = function() {
    $("small.error").hide();
    return console.log("Slack :)");
  };

  $("form").submit(function() {
    var formData;
    console.log("Form submit");
    $("small.error").hide();
    formData = {
      'url': $('input[name=url]').val()
    };
    $.ajax("/fetch", {
      type: 'POST',
      contentType: "application/json; charset=utf-8",
      dataType: 'json',
      encode: true,
      data: JSON.stringify(formData),
      error: function(jqXHR, textStatus, errorThrown) {
        $("small.error").show();
        if (jqXHR.status === 400) {
          $("small.error").html(jqXHR.responseJSON.details ? jqXHR.responseJSON.details : jqXHR.responseJSON.message);
        } else if (jqXHR.status === 500) {
          $("small.error").html(jqXHR.responseJSON.details ? jqXHR.responseJSON.details : jqXHR.responseJSON.message);
        } else {
          $("small.error").html("Something went wrong. Try again!");
        }
      },
      success: function(data, textStatus, jqXHR) {
        console.log("Successful :)");
        $("#urid").text(jqXHR.responseJSON.url);
        $("#html").text(jqXHR.responseJSON.source).html();
        $('#html').each(function(i, block) {
          hljs.highlightBlock(block);
        });
        processTagCount(jqXHR.responseJSON.tagCount);
      }
    });
    event.preventDefault();
  });

  processTagCount = function(tagCountObj) {
    var k, list, v;
    list = "";
    for (k in tagCountObj) {
      v = tagCountObj[k];
      console.log(k);
      list = list + ("<li><a href=\"javascript:myFunction1('" + k + "');\">" + k + "</a>&mdash;" + v + "</li>");
    }
    $("#tagCount").html(list);
  };

  highlightBlock = (function(_this) {
    return function(tagName) {
      return alert(tagName);
    };
  })(this);

  init();

}).call(this);

function myFunction1(tagName) {
  tagName = tagName.toLowerCase();
  $("#html span").removeClass("highlight");
  $("#html span[class='hljs-"+tagName+"-title']").parent().addClass("highlight");
}
